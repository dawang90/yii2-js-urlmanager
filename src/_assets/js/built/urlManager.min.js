String.prototype.escapeRegexp = function () {
    return this.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
};
Object.prototype.buildQueryString = function () {
    var _this = this;
    return Object.keys(this)
        .map(function (key) { return encodeURIComponent(key) + '=' + encodeURIComponent(_this[key]); })
        .join('&');
};
var UrlRule = (function () {
    function UrlRule(name, route) {
        this.name = name;
        this.route = route;
    }
    ;
    UrlRule.prototype.createUrl = function (route, urlParams) {
        if (urlParams === void 0) { urlParams = {}; }
        if (route !== this.route) {
            return false;
        }
        var regexpGroups = /<([\w._-]+):?([^>]+)?>/g;
        var matches;
        var resultRule = this.name;
        var validRule = true;
        do {
            matches = regexpGroups.exec(this.name);
            if (matches) {
                var group = matches[0], groupKey = matches[1], groupRegexpString = matches[2];
                var groupRegexp = new RegExp(groupRegexpString);
                if (!groupRegexp.test(urlParams[groupKey])) {
                    validRule = false;
                    break;
                }
                resultRule = resultRule.replace(new RegExp(group.escapeRegexp()), urlParams[groupKey]);
            }
        } while (matches);
        if (!validRule) {
            return this.route + '?' + urlParams.buildQueryString();
        }
        return resultRule;
    };
    return UrlRule;
}());
var UrlManager = (function () {
    function UrlManager(config) {
        this.enablePrettyUrl = config.enablePrettyUrl;
        this.rules = this.buildRules(config.rules);
    }
    ;
    UrlManager.prototype.buildRules = function (rules) {
        var result = [];
        for (var _i = 0, rules_1 = rules; _i < rules_1.length; _i++) {
            var rule = rules_1[_i];
            result.push(new UrlRule(rule.name, rule.route));
        }
        return result;
    };
    ;
    UrlManager.prototype.createUrl = function (route, urlParams) {
        var result = route;
        for (var _i = 0, _a = this.rules; _i < _a.length; _i++) {
            var rule = _a[_i];
            var compiledRule = rule.createUrl(route, urlParams);
            if (compiledRule !== false) {
                return compiledRule;
            }
        }
        return result;
    };
    return UrlManager;
}());
